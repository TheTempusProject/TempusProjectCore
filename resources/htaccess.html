RewriteEngine On
RewriteBase {APP_WEB_ROOT}

# Intercepts other errors
RewriteRule ^errors/(.*)$ index.php?error=$1 [L,NC,QSA]

# Intercept all traffic not originating locally and not going to images or uploads
RewriteCond %{REMOTE_ADDR} !^127\.0\.0\.1
RewriteCond %{REMOTE_ADDR} !^\:\:1
RewriteRule ^(.+)$ {APP_WEB_ROOT}?url=$1 [QSA,L]

# Catchall for any non existent files or folders
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.+)$ {APP_WEB_ROOT}?url=$1 [QSA,L]";
